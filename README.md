<p><b>*NOTE:</b> "schedules" as used in endpoints refer to <b>childrens'</b> <b>enrollments</b> to <b>courses</b>; "schedule" specific endpoints join the <b>children</b>, <b>enrollments</b>, and <b>courses</b> tables and return data matching the given <b>profile_id</b></p>

<h1>Profiles</h1>

```

{
  profile_id: INCREMENT (primary key, auto-increments, generated by database),
  okta_id: STRING (unique),
  name: STRING (required),
  email: STRING (required),
  role_id: INTEGER (required, foreign key),
  avatarUrl: STRING (required, defaults to: 'https://i.stack.imgur.com/frlIf.png'),
}
```

| Method   | URL                                                                                                                    | Description                                                                                                              |
| -------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| [GET]    | /profile/                                                                                                              | Returns an array of all existing profiles.                                                                               |
| [GET]    | /profile/:okta_id/                                                                                                     | Returns the profile object with the specified `okta_id`.                                                                 |
| [GET]    | /profiles/users/:profile_id <b>(BUG: /profiles/users route does not exist; app.js only connects to /profiles/user)</b> | Returns an array filled with event objects that contains information based on profile_id and role_id.                    |
| [GET]    | /profile/role/:role_id <b>(BUG: does not return any data)</b>                                                          | Returns an array filled with event objects that contain information based on role_id for all profiles of a role_id type. |
| [POST]   | /profile/                                                                                                              | Requires a name, password, and email. Registers a new user.                                                              |
| [PUT]    | /profile/                                                                                                              | Returns an event object with the specified `okta`. Updates specific profile.                                             |
| [DELETE] | /profile/:okta_id/                                                                                                     | Returns an event object with the specified `okta`. Deletes specific profile.                                             |

#### User:

<p>These endpoints are user-focused. As opposed to the more flexible Profile endpoints where <b>profile_id</b> must be specified, these endpoints retrieve data specific only to the user profile that is making the API request by using the logged-in user's <b>profile_id</b>.</p>

| Method | URL              | Description                                                                 |
| ------ | ---------------- | --------------------------------------------------------------------------- |
| [GET]  | /user/           | Returns an event object with the specified `okta` and `type`.               |
| [GET]  | /user/inbox/     | Returns an event object with the specified `okta`. <b>(NOT IMPLEMENTED)</b> |
| [GET]  | /user/schedules/ | Returns an event object with the specified `okta`.                          |
| [PUT]  | /user/           | Returns an event object with the specified `id`. Updates specific user.     |
| [POST] | /user/register   | Posts a new user in the database and in the Okta Dashboard.                 |

NOTE: these are the password requirements: at least 8 characters, a lowercase letter, an uppercase letter, a number, no parts of your username.  
The required fields include the following: {
firstName: string,
lastName: string,
email: string,
password: string,
role_id: int,
avatarUr(not required): string,
}

<h1>Parents</h1>

```
{
  parent_id: INCREMENT (primary key, auto-increments, generated by database),
  profile_id: INTEGER (required, foreign key),
}
```

| Method | URL                            | Description                                                                           |
| ------ | ------------------------------ | ------------------------------------------------------------------------------------- |
| [GET]  | /parent/:profile_id/children/  | Returns an array filled with children event objects with the specified `profile_id`.  |
| [GET]  | /parent/:profile_id/schedules/ | Returns an array filled with schedules event objects with the specified `profile_id`. |

<h1>Children</h1>

```
{
  child_id: INCREMENT (primary key, auto-increments, generated by database),
  profile_id: INTEGER (required, unique, foreign key),
  username: STRING (required),
  age: INTEGER (required),
  parent_id: INTEGER (required, foreign key),
}
```

| Method   | URL                             | Description                                                                                                 |
| -------- | ------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| [GET]    | /children                       | Returns an array containing all existing children.                                                          |
| [POST]   | /children                       | Requires a username, name, and age. Returns the name, profile_id, and parent_id.                            |
| [GET]    | /children/:child_id             | Returns the child with the given 'id'.                                                                      |
| [PUT]    | /children/:child_id             | Returns the updated child object                                                                            |
| [DELETE] | /children/:child_id             | Returns the name of the child deleted                                                                       |
| [GET]    | /children/:child_id/enrollments | Returns an array filled with event objects with the specified `id`.                                         |
| [POST]   | /children/:child_id/enrollments | Returns the event object with the specified `id`. Enrolls a student.                                        |
| [PUT]    | /children/enrollments/          | Returns the event object with the specified `id`. Updates a student's enrollments. <b>(Not Implemented)</b> |
| [DELETE] | /children/enrollments/:id       | Returns the event object with the specified `id`. Unenrolls student from course. <b>(Not Implemented)</b>   |

<h1>Instructors</h1>

```
{
  instructor_id: INCREMENT (primary key, auto-increments, generated by database),
  rating: INTEGER (required),
  availability: STRING (optional),
  bio: STRING (required),
  profile_id: INTEGER (required, foreign key),
  status: STRING (required, default: 'pending'),
  approved_by: INTEGER (optional, foreign key, default: null, references admin_id),
}
```

| Method | URL                  | Description                                                                                           |
| ------ | -------------------- | ----------------------------------------------------------------------------------------------------- |
| [GET]  | /instructor/courses/ | Returns an array containing all course event objects belonging to the currently logged in instructor. |

<h1>Programs</h1>

```
{
  program_id: INCREMENT (primary key, auto-increments, generated by database),
  program_name: STRING (required, unique),
  program_description: STRING (required),
}
```

| Method   | URL          | Description                                                                                                  |
| -------- | ------------ | ------------------------------------------------------------------------------------------------------------ |
| [GET]    | /program/    | Returns an array filled with program objects.                                                                |
| [GET]    | /program/:id | Returns the program object with the specified `id`.                                                          |
| [POST]   | /program/    | Contains fields: `program_name` and `program_description`. Returns the newly created program object.         |
| [PUT]    | /program/:id | Updates the program with the specified `id` using data from the `request body`. Returns the modified program |
| [DELETE] | /program/:id | Removes the program with the specified `id` and returns deletion success message .                           |

<h1>Courses</h1>

```
{
  course_id: INCREMENT (primary key, auto-increments, generated by database),
  course_name: STRING (required),
  course_description: STRING (required),
  days_of_week: ARRAY[strings] (optional),
  max_size: INTEGER (required),
  min_age: INTEGER (required),
  max_age: INTEGER (required),
  instructor_id: INTEGER (required, foreign key),
  program_id: INTEGER (required, foreign key),
  start_time: TIME (required),
  end_time: TIME (required),
  start_date: DATE (required),
  end_date: DATE (required),
  location: STRING (required),
  number_of_sessions: INTEGER (required),
  instructor_name: STRING (required)
}
```

| Method   | URL                | Description                                                                                                                            |
| -------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------- |
| [GET]    | /course            | Returns an array containing all course objects                                                                                         |
| [GET]    | /course/:course_id | Returns the course object with the specified `course_id`.                                                                              |
| [POST]   | /course            | --needs to be fleshed out--                                                                                                            |
| [PUT]    | /course/:course_id | Updates and returns the updated course object with the specified `course_id`.                                                          |
| [DELETE] | /course/:course_id | Deletes the course object with the specified `course_id` and returns a message containing the deleted course_id on successful deletion |

<h1>Newsfeed</h1>

```
{
  newsfeed_id: INCREMENT (primary key, auto-increments, generated by database),
  title: STRING (required),
  link: STRING (required),
  description: STRING (required),
  posted_at: TIMESTAMP (auto-generated),
}
```

| Method   | URL                     | Description                                                                                   |
| -------- | ----------------------- | --------------------------------------------------------------------------------------------- |
| [GET]    | /newsfeed/              | Returns an array containing all newsfeed objects.                                             |
| [GET]    | /newsfeed/:newsfeed_id/ | Returns the event object with the specified `newsfeed_id`.                                    |
| [POST]   | /newsfeed/              | Creates a new newsfeed object and returns the newly created newsfeed.                         |
| [PUT]    | /newsfeed/:newsfeed_id  | Updates the newsfeed object with the given newsfeed_id and returns the newly updated newsfeed |
| [DELETE] | /newsfeed/:newsfeed_id/ | Deletes the newsfeed object with the given newsfeed_id and returns the deleted newsfeed.      |

<h1>Conversations</h1>

```
{
  conversation_id: INCREMENT (primary key, auto-increments, generated by database),
  profile_id: INTEGER (required, foreign key),
}
```

| Method   | URL                           | Description                                                                                                                      |
| -------- | ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| [GET]    | /conversation_id/             | Returns an array filled with inbox event objects.                                                                                |
| [GET]    | /conversation_id/:profile_id/ | Retrieves an inbox with the specified inbox_id <b>BUG(?): incorrectly labeled as profile_id in codebase rather than inbox_id</b> |
| [POST]   | /conversation_id/             | Creates an inbox and returns the newly created inbox.                                                                            |
| [POST]   | /conversation_id/messages/    | Returns the event object with the specified `inbox_id`. Sends a message.                                                         |
| [PUT]    | /conversation_id/:profile_id  | Returns an array filled with event objects with the specific `profile_id`. Updates an inbox.                                     |
| [DELETE] | /conversation_id/:profile_id/ | Returns an array filled with event objects with the specific `okta`. Deletes an inbox.                                           |

<h1>Calendar Events</h1>

```
{
  event_id: INCREMENT (primary key, auto-increments, generated by database),
  date: STRING (required),
  time: STRING (required),
  type: STRING (required),
  content: STRING (required),
  details: STRING (required),
  profile_id: INTEGER (required, foreign key, auto-generated by database),
}
```

| Method   | URL                         | Description                                                                         |
| -------- | --------------------------- | ----------------------------------------------------------------------------------- |
| [GET]    | /calendar-events/           | Returns an array filled with calendar event objects.                                |
| [GET]    | /calendar-events/user/      | Retrieves calendar event objects with the profile_id of logged in user              |
| [GET]    | /calendar-events/:event_id/ | Retrieves calendar event object with the specified event_id                         |
| [POST]   | /calendar-events/           | Creates a calendar event and returns the newly created calendar event.              |
| [PUT]    | /calendar-events/:event_id  | Updates and returns the updated calendar event object with the specific `event_id`. |
| [DELETE] | /calendar-events/:event_id/ | Deletes a calendar event and returns a success message on successful deletion.      |

<h1>Schedule (Not Implemented)</h1>

| Method   | URL                 | Description                                                                  |
| -------- | ------------------- | ---------------------------------------------------------------------------- |
| [GET]    | /schedule/          | Returns an array filled with event objects.                                  |
| [GET]    | /schedule/:id/      | Returns the event object with the specified `id`.                            |
| [POST]   | /schedule/          | Returns the event object with the specified `id`. Creates a schedule.        |
| [POST]   | /schedule/sessions/ | Returns the event object with the specified `id`. Creates a session.         |
| [PUT]    | /schedule/          | Returns the event object with the specified `id`. Updates specific schedule. |
| [DELETE] | /schedule/:id/      | Returns the event object with the specified `id`. Deletes specific schedule. |

<h1>Data Tables Without Existing Endpoints</h1>

<h2>Super Admins</h2>

```
{
  super_admin_id: INCREMENT (primary key, auto-increments, generated by database),
  profile_id: INTEGER (required, foreign key),
}
```

<h2>Admins</h2>

```
{
  admin_id: INCREMENT (primary key, auto-increments, generated by database),
  profile_id: INTEGER (required, foreign key),
}
```

<h2>Messages</h2>

```
{
  messages_id: INCREMENT (primary key, auto-increments, generated by database),
  sent_at: TIMESTAMP (auto-generated),
  title: STRING (required),
  read: BOOLEAN (required, default: false),
  message: STRING (required),
  sent_by_profile_id: INTEGER (required, foreign key),
  inbox_id: INTEGER (required, foreign key,
}
```

<h2>Instructors' Program Types</h2>
<p><b>Join Table:</b> Programs instructors are approved to teach

```
{
  instructors_program_types_id: INCREMENT (primary key, auto-increments, generated by database),
  instructor_id: INTEGER (required, foreign key),
  program_id: INTEGER (required, foreign key),
}
```

<h2>Enrollments</h2>
<p><b>Join Table:</b> Courses signed up for by children

```
{
  enrollments_id: INCREMENT (primary key, auto-increments, generated by database),
  completed: BOOLEAN (required, default: false),
  child_id: INTEGER (required, foreign key),
  course_id: INTEGER (required, foreign key),
}
```

<h2>Resources</h2>

```
{
  resource_id: INCREMENT (primary key, auto-increments, generated by database),
  resource: STRING (required),
  description: STRING (optional),
  task: BOOLEAN (required),
  instructor_id: INTEGER (required, foreign key),
}
```

Visual Database Schema: https://dbdesigner.page.link/WTZRbVeTR7EzLvs86 <b>\*Currently Outdated</b>

[Loom Video PT1](https://www.loom.com/share/4543abe4659540698c327058362f90f3)
[Loom Video PT2](https://www.loom.com/share/c4e8c8f38cb14fdb8ac43e6a2342f159)
[Loom Video PT3](https://www.loom.com/share/39128df605f44263b1b4a5b8ddbcddb3)
[Loom Video PT4](https://www.loom.com/share/7da5fc043d3149afb05876c28df9bd3d)

<br />

<h2>Email Service</h2>
In api/email, the emailHelper.js file contains the following functions: sendEmail and addToList. SendEmail sends an API request to SendGrid to send a templated email to the to email address its given. The other function: addToList adds the email and name to a specified SendGrid contact list (they're added to all no matter what, then also to the specified list id). Any function that wants to use sendEmail and addToList will need to import it into their file (see profileRouter.js). Parameters can be passed into it, like the toEmail, name, template_id or list_ids (which is an array so it could have more than 1 list_ids there). The parameters to use are created in the file that's calling the sendEmail function.

SendGrid's npm package info and how to set up the API key (also listed below): https://www.npmjs.com/package/@sendgrid/mail. The npm package is @sendgrid/mail. Very lightweight, highly supported, and heavily downloaded. (SendGrid also supports Java)

Loom walkthrough on backend: https://www.loom.com/share/a7d867ee6f9f4bca9a4a3e911bca3de4
Loom how to see if it's working: https://www.loom.com/share/7acaa082c8454ac4bf17e0670aec18d7

To set up SendGrid at https://sendgrid.com/:

- Create an account with SendGrid
- Create an API (replace YOUR_API_KEY with the API you receive from SendGrid into the below terminal command)
- In your terminal, do these commands:
  echo "export SENDGRID_API_KEY='YOUR_API_KEY'" > sendgrid.env
  echo "sendgrid.env" >> .gitignore
  source ./sendgrid.env

SendGrid will look at its own .env file for the API key. Unclear as to whether it's possible to put other environment variables there - it's been inconsistent in testing. (Send new keys via the first and third commands listed above. The second one only adds sendgrid.env to .gitignore so you don't share secrets.) When accessing SendGrid's .env file, use process.env.SENDGRID_API_KEY, just as if you had put the key in the .env file.

Templates exist on SendGrid's site, under "Dynamic Templates." When requesting an email be sent, you'll use the template_id as one of the parameters you pass on to sendEmail. If you want a starting spot for what your emails could say (pending stakeholder approval), here's some copy: https://docs.google.com/document/d/1WZQ6Njj0Xt_eXLAEWm0nYA7eqACByFinpyrh7EjcU8U/edit?usp=sharing

Dynamic template data: the template will be looking for something from the json request that matches the field you put in the template. For example, "name": "Some Name" coming from your email request will match {{ name }} in the template. Double curly braces make that connection.

Potential templates to be created plus an idea for what the template_id will look like (could update this list as the templates are created on SendGrid - the template_id is generated by SendGrid when you create a Dynamic Template):

EmailType = {
WELCOME_EMAIL_PARENT: 'd-026a2f461bdd480098be08a2cb949eea', (All 3 welcome emails go out automatically upon post from the profileRouter. Change template id based on role_id.)
WELCOME_EMAIL_INSTRUCTOR: 'd-a4de80911362438bb35d481efa068398',
WELCOME_EMAIL_STUDENT: 'd-026a2f461bdd480098be08a2cb949eea',
INSTRUCTOR_SUBMITTED_APPLICATION: 'd-026a2f461bdd480098be08bxhsyeyyy', (Goes out when an instructor submits an application and lets them know about the next step in the approval process.)
INSTRUCTOR_APPLICATION_REVIEW: 'd-026a2f461bdd480098be08bxhsyeyyy', email to admin or staff that an application is ready to be approved or denied
CHANGE_PASSWORD: 'd-026a2f4hsyw20098be08a2cb949eea',
PURCHASED_COURSE_PARENT: 'd-026a2f461bdd480098be08bxhsyeyyy', (Upon enrollment of a child student, to include the start date, time, and Zoom link)
PURCHASED_COURSE_STUDENT: 'd-026a2f461bdd480098be08bxhsyeyyy', (Upon enrollment of a child student, email sent to student to include the start date, time, and Zoom link)
INSTRUCTOR_IS_APPROVED: 'd-026a2f461bdd480098be08bxhsyeyyy', (Congrats, you've been approved, with link to create a course)
INSTRUCTOR_IS_REJECTED: 'd-026a2f461bdd480098be08bxhsyeyyy', (Sorry, friend! We'll keep your info on file for future needs)
STUDENT_CLASS_REMINDER: 'd-026a2f461bdd480098be08bxhsyeyyy', (Could be 2 emails to land 1 hour, or 5 minutes before class starts, with the class start time and Zoom link)
PARENT_CLASS_REMINDER: 'd-026a2f461bdd480098be08bxhsyeyyy', (Same as above with different wording)
};

AddToList: First up , add list(s) to the SendGrid account. In addition to the default "all" list, we added instructors, parents, and students. From a marketing perspective, these are the major groups, each requiring a different kind of information, and will potentially need different mass email types.

As part of the request in emailHelper.js, you'll send the id(s) of the contact list (list_ids, an array) you want to add the email to, plus any additional data you want to add to the request, like the email address (as 'email') and name (as 'first_name'). If you use custom fields, make sure the fields are already set up in SendGrid or SG won't know where to map them.
